name: Goose Winter Festival Triage
on:
  issues:
    types: [opened]

jobs:
  triage:
    runs-on: ubuntu-latest
    steps:
      - name: Checkout
        uses: actions/checkout@v4

      - name: Setup Goose
        run: |
          # Download and extract the binary directly to skip interactive configuration
          curl -fsSL https://github.com/block/goose/releases/latest/download/goose-x86_64-unknown-linux-gnu.tar.bz2 -o goose.tar.bz2
          tar -xjf goose.tar.bz2
          mkdir -p $HOME/.local/bin
          # The binary is usually in the root or a bin folder of the archive
          mv goose $HOME/.local/bin/goose 2>/dev/null || mv bin/goose $HOME/.local/bin/goose
          chmod +x $HOME/.local/bin/goose
          echo "$HOME/.local/bin" >> $GITHUB_PATH

      - name: Run Goose Triage
        env:
          GOOGLE_API_KEY: ${{ secrets.GEMINI_API_KEY }}
          GITHUB_TOKEN: ${{ secrets.GITHUB_TOKEN }}
          GOOSE_PROVIDER: google
          GOOSE_MODEL: gemini-3-flash-preview
        run: |
          goose run --extension github "Analyze the new issue #${{ github.event.issue.number }} in ${{ github.repository }}. 
          1. Use the github extension to read the issue content.
          2. Categorize it as 'urgent' (if it mentions safety, security, or cancellations) or 'low-priority' (if it is general feedback, praise, or general info).
          3. Apply the appropriate category label AND the 'winter-festival' label.
          4. Post a comment:
             - If urgent: 'Thank you for reporting this safety/critical issue. Our team has been notified and will address this immediately.'
             - If low-priority: 'Thank you for your feedback/inquiry regarding the Winter Festival! We have triaged this and will get back to you soon.'"
